// Finding attackers hiding malware in the recycle bin
// Tags: #execution #SuspiciousPath
let EXE = dynamic(['cmd.exe','ftp.exe','schtasks.exe','powershell.exe','rundll32.exe','regsvr32.exe','msiexec.exe']);
SentinelOne_CL
| where TimeGenerated >= ago(90d)
| extend FileName = tostring(parse_json(DataFields_s).sourceprocessfilepath)
| extend ProcessCommandLine  = tostring(parse_json(DataFields_s).sourceprocesscommandline)
| where FileName has_any (EXE)
| where ProcessCommandLine contains ":\\recycler"