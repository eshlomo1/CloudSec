// Title: Potential Exploitation of CVE-2024-3094 - Suspicious SSH Child Process
// Use-Case: Detects potentially suspicious child process of SSH process (sshd) with a specific execution user 
// FP Potential: Activities with root authentication could trigger selection_x 
// Detection Tag: CVE.2024.3094
// MITRE ATT&CK: T1059.004
// MITRE Tactics: Execution
DeviceProcessEvents
| where TimeGenerated >= ago(31d)
| where ((InitiatingProcessFolderPath endswith '/sshd' 
    and (ProcessCommandLine startswith 'bash -c' 
    or ProcessCommandLine startswith 'sh -c') 
    and (InitiatingProcessAccountDomain =~ 'root' 
    or InitiatingProcessAccountName =~ 'root')) 
    or (InitiatingProcessFolderPath endswith '/sshd' 
    and FolderPath endswith '/sshd' 
    or InitiatingProcessAccountName =~ 'sshd'))
 